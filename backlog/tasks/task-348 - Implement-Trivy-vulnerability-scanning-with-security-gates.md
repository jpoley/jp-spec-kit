---
id: task-348
title: Implement Trivy vulnerability scanning with security gates
status: To Do
assignee: []
created_date: '2025-12-09 01:03'
labels:
  - infrastructure
  - cicd
  - security
dependencies: []
priority: high
---

## Description

<!-- SECTION:DESCRIPTION:BEGIN -->
Configure Trivy scanner to fail builds on HIGH/CRITICAL vulnerabilities and upload results to GitHub Security.

**Configuration**:
- Severity threshold: `HIGH,CRITICAL`
- Exit code: `1` (fail on findings)
- Output formats: SARIF (for GitHub) + table (for artifacts)

**Implementation**:
1. Test Trivy locally on built image:
   ```bash
   docker run --rm -v /var/run/docker.sock:/var/run/docker.sock \
     aquasec/trivy image --severity HIGH,CRITICAL ai-coding-agents-test:local
   ```

2. Verify SARIF output format:
   ```bash
   trivy image --format sarif --output trivy.sarif ai-coding-agents-test:local
   ```

3. Test GitHub Security upload (requires SARIF file)

4. Create exception process for false positives:
   - Document in `.trivyignore` file
   - Require security review for exceptions

**Security Review Process**:
1. If Trivy scan fails, review findings
2. Update base image or affected packages
3. If no fix available, document in security review
4. Add to `.trivyignore` with expiration date and justification

**Monitoring**:
- Track vulnerability count over time
- Alert on new CRITICAL findings
- Review ignored vulnerabilities monthly
<!-- SECTION:DESCRIPTION:END -->

## Acceptance Criteria
<!-- AC:BEGIN -->
- [ ] #1 Trivy scan runs successfully in CI pipeline
- [ ] #2 Scan fails build if HIGH or CRITICAL vulnerabilities found
- [ ] #3 SARIF results uploaded to GitHub Security tab
- [ ] #4 Table format report available as artifact
- [ ] #5 Trivy scan completes in < 3 minutes
- [ ] #6 Process documented for handling false positives
<!-- AC:END -->
