# Security Scanning Workflow
#
# This workflow calls the reusable security-scan.yml workflow for various triggers:
# - Pull requests
# - Push to main/develop
# - Scheduled nightly scans
# - Manual workflow dispatch
#
# See .github/workflows/security-scan.yml for the reusable workflow implementation.

name: Security Scanning

on:
  pull_request:
    branches: [main, develop]
    paths:
      - 'src/**'
      - 'tests/**'
      - '*.py'
      - 'pyproject.toml'
  push:
    branches: [main, develop]
    paths:
      - 'src/**'
      - 'tests/**'
      - '*.py'
      - 'pyproject.toml'
  schedule:
    # Run nightly at 2 AM UTC
    - cron: '0 2 * * *'
  workflow_dispatch:
    inputs:
      scan-type:
        description: 'Scan type (incremental, full, fast)'
        required: false
        default: 'full'
        type: choice
        options:
          - incremental
          - full
          - fast
      fail-on:
        description: 'Severity levels to block on'
        required: false
        default: 'critical,high'
        type: string

jobs:
  # Standard security scan for PRs and pushes
  security-scan:
    name: Security Scan
    uses: ./.github/workflows/security-scan.yml
    with:
      scan-type: ${{ github.event_name == 'pull_request' && 'incremental' || inputs.scan-type || 'full' }}
      fail-on: ${{ inputs.fail-on || 'critical,high' }}
      upload-sarif: true
      scan-path: '.'
    secrets: inherit
    permissions:
      contents: read
      security-events: write
      pull-requests: write
