{"timestamp": "2025-12-16T19:00:00Z", "decision_id": "DEC-001", "category": "root_cause_analysis", "title": "Documentation CI Failure Root Cause Identified", "description": "The docs.yml workflow fails because docs/docfx.json was accidentally deleted in commit b2ea519 on 2025-12-14. The commit claimed 'No files deleted' but actually removed the entire docs/ directory contents including docfx.json and toc.yml.", "evidence": ["GitHub Actions run 20279094794 failed with: jq: error: Could not open file docs/docfx.json: No such file or directory", "git log shows docs/docfx.json was deleted in commit b2ea519", "7 consecutive failures since Dec 14, 2025"], "impact": "critical", "status": "confirmed"}
{"timestamp": "2025-12-16T19:01:00Z", "decision_id": "DEC-002", "category": "architecture_analysis", "title": "Documentation Structure Split Discovered", "description": "The documentation was restructured into three directories: user-docs/ (user-facing content), build-docs/ (developer docs + DocFX config), and docs/ (leftover files). The DocFX config in build-docs/ expects content co-located but content is now in user-docs/.", "affected_files": ["build-docs/docfx.json", "build-docs/toc.yml", "user-docs/index.md", "user-docs/installation.md", "user-docs/quickstart.md", "user-docs/guides/"], "status": "confirmed"}
{"timestamp": "2025-12-16T19:02:00Z", "decision_id": "DEC-003", "category": "fix_option", "title": "Option A: Update docfx.json to Reference user-docs/", "description": "Modify build-docs/docfx.json to include ../user-docs/**/*.md in content paths. Update workflow to run from build-docs/ directory. Pros: Minimal file moves. Cons: Complex relative path management.", "complexity": "medium", "recommended": false}
{"timestamp": "2025-12-16T19:03:00Z", "decision_id": "DEC-004", "category": "fix_option", "title": "Option B: Consolidate to Single DocFX Directory", "description": "Move docfx.json and toc.yml to user-docs/ and update workflow to build from user-docs/. Pros: Clean DocFX standard structure. Cons: Requires updating references in toc.yml.", "complexity": "medium", "recommended": true}
{"timestamp": "2025-12-16T19:04:00Z", "decision_id": "DEC-005", "category": "fix_option", "title": "Option C: CI Assembly of DocFX Directory", "description": "During CI, copy/symlink all content into a temporary directory with proper DocFX structure. Pros: No file moves needed. Cons: More complex CI, harder to test locally.", "complexity": "high", "recommended": false}
{"timestamp": "2025-12-16T19:05:00Z", "decision_id": "DEC-006", "category": "selected_approach", "title": "Selected Fix: Consolidate DocFX to user-docs/ (Option B)", "description": "Chosen approach is to move docfx.json and toc.yml from build-docs/ to user-docs/, making user-docs/ the canonical DocFX documentation directory. This follows DocFX best practices of having config co-located with content.", "rationale": ["Follows DocFX conventions", "Easier local testing with docfx serve", "Cleaner separation: user-docs for published site, build-docs for internal dev docs", "Matches toc.yml structure which references files relative to its location"], "status": "approved"}
{"timestamp": "2025-12-16T19:06:00Z", "decision_id": "DEC-007", "category": "resilience", "title": "Add Prerequisite Validation Step", "description": "Add a new workflow step that validates all required files exist before attempting DocFX build. Fail fast with clear error messages if docfx.json or toc.yml are missing.", "implementation": "New 'Validate documentation structure' step with explicit file existence checks", "status": "approved"}
{"timestamp": "2025-12-16T19:07:00Z", "decision_id": "DEC-008", "category": "resilience", "title": "Add Self-Healing Fallback", "description": "If docfx.json is missing, check for it in alternative locations (build-docs/, templates/) and copy it. Provides graceful degradation.", "implementation": "Conditional copy logic in validation step", "status": "approved"}
{"timestamp": "2025-12-16T19:08:00Z", "decision_id": "DEC-009", "category": "alerting", "title": "GitHub Issue Creation on Failure", "description": "Use gh CLI in workflow to create a GitHub issue when documentation deployment fails. Include run URL, failure step, and error message for immediate visibility.", "implementation": "Add post-failure job that creates/updates issue with label 'ci-failure'", "status": "approved"}
{"timestamp": "2025-12-16T19:09:00Z", "decision_id": "DEC-010", "category": "alerting", "title": "Add Failure Notification Job", "description": "Add a separate job that runs only on failure, creating visibility through GitHub issue and optional Slack webhook.", "implementation": "New 'notify-failure' job with if: failure() condition", "status": "approved"}
{"timestamp": "2025-12-16T19:10:00Z", "decision_id": "DEC-011", "category": "prevention", "title": "Add CODEOWNERS for Workflow Protection", "description": "Protect .github/workflows/docs.yml and user-docs/docfx.json with CODEOWNERS requiring review before changes to prevent accidental breakage.", "implementation": "Update .github/CODEOWNERS with path patterns", "status": "approved"}
{"timestamp": "2025-12-16T19:11:00Z", "decision_id": "DEC-012", "category": "prevention", "title": "Add CI Validation for DocFX Structure", "description": "Add a lightweight CI check that validates DocFX configuration on every PR that touches docs. Catch issues before merge.", "implementation": "Add docfx build --dry-run or schema validation step", "status": "approved"}
{"timestamp": "2025-12-16T20:45:00Z", "decision_id": "DEC-013", "category": "prevention", "title": "ABSOLUTE BLOCK on Critical File Deletion", "description": "There is NO legitimate reason to delete docfx.json, toc.yml, or other critical CI files. EVER. The previous approach of allowing bypass with --no-verify was wrong. These files must be protected absolutely.", "implementation": "Pre-commit hook with NO bypass option, CI check that blocks merge if files missing", "lesson_learned": "Claude failed to verify file existence before restructuring. Commit message lied about 'no files deleted'. Trust nothing, verify everything.", "status": "enforced"}
{"timestamp": "2025-12-16T20:46:00Z", "decision_id": "DEC-014", "category": "prevention", "title": "Critical Files CI Check", "description": "Add .github/workflows/critical-files.yml that runs on every PR and push to main. Validates that critical files exist and blocks merge if any are deleted.", "implementation": "New workflow that checks file existence and fails loudly if critical files are missing", "files_protected": ["user-docs/docfx.json", "user-docs/toc.yml", "user-docs/index.md", ".github/workflows/docs.yml", ".github/workflows/ci.yml", ".github/workflows/release.yml", "pyproject.toml", "CLAUDE.md"], "status": "enforced"}
{"timestamp": "2025-12-16T20:47:00Z", "decision_id": "DEC-015", "category": "accountability", "title": "Post-Mortem: Claude's Failure on Dec 14, 2025", "description": "Claude (the AI assistant) made a commit that deleted docs/docfx.json while claiming 'No files deleted - all content preserved and reorganized'. This was a lie. The AI failed to: 1) Verify the commit actually preserved all files, 2) Check if any workflows depended on deleted files, 3) Run CI locally before pushing. This resulted in 7+ consecutive CI failures over 2 days.", "root_cause": "AI blindly trusted its own commit message without verification", "prevention": "Pre-commit hooks, CI checks, and explicit file protection now in place", "status": "documented"}
